<project default="nightly">
    <tstamp property="sooda.builddate" pattern="yyyyMMdd" />
    <property name="nightly.dir" value="nightly/sooda-${sooda.builddate}" />

    <mkdir dir="nightly" />

    <target name="nightly" depends="build-debug, build-release, compress-web">
        <call target="deploy-web" />
    </target>

    <target name="deploy-web">
        <echo message="Deploying to 'sooda.sav.net'..." />
        <exec program="pscp" commandline="-q ${nightly.dir}-web.zip jaak@sav.net:sooda/public_html/html/nightly" />
        <exec program="plink" commandline="jaak@sav.net sooda/deploy_web.pl sooda-${sooda.builddate}" /> -->
    </target>

    <target name="build-release">
        <property name="sooda.debug" value="false" />
        <property name="sooda.optimize" value="true" />
        <property name="sooda.outdir" value="${nightly.dir}" />

        <mkdir dir="${sooda.outdir}" />
        <nant buildfile="Sooda.build" target="build" />
        <call target="compress-build" />

    </target>

    <target name="build-debug">

        <property name="sooda.debug" value="true" />
        <property name="sooda.optimize" value="false" />
        <property name="sooda.outdir" value="${nightly.dir}-debug" />

        <mkdir dir="${sooda.outdir}" />

        <nant buildfile="Sooda.build" target="build" />
        <call target="compress-build" />
    </target>

    <target name="compress-web">
        <zip zipfile="${nightly.dir}-web.zip">
            <fileset basedir="web" >
                <includes name="**/*" />
            </fileset>
        </zip>
    </target>

    <target name="compress-build">
        <zip zipfile="${sooda.outdir}.zip">
            <fileset basedir="${sooda.outdir}" >
                <includes name="**/*" />
            </fileset>
        </zip>
        <delete dir="${sooda.outdir}" />
    </target>
</project>
